<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday, Brother!</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for confetti animation */
        @keyframes confetti-fall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        .confetti-piece {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f0f; /* Example color */
            border-radius: 50%; /* Make it round */
            animation: confetti-fall linear infinite;
            opacity: 0;
            z-index: 10;
        }

        /* Adjust animation delay and duration for each piece */
        .confetti-piece:nth-child(1) { left: 10%; background-color: #ff0; animation-duration: 2s; animation-delay: 0s; }
        .confetti-piece:nth-child(2) { left: 20%; background-color: #0ff; animation-duration: 2.5s; animation-delay: 0.5s; }
        .confetti-piece:nth-child(3) { left: 30%; background-color: #f0f; animation-duration: 3s; animation-delay: 1s; }
        .confetti-piece:nth-child(4) { left: 40%; background-color: #0f0; animation-duration: 2s; animation-delay: 1.5s; }
        .confetti-piece:nth-child(5) { left: 50%; background-color: #f80; animation-duration: 2.8s; animation-delay: 0.2s; }
        .confetti-piece:nth-child(6) { left: 60%; background-color: #80f; animation-duration: 2.3s; animation-delay: 0.8s; }
        .confetti-piece:nth-child(7) { left: 70%; background-color: #00f; animation-duration: 3.2s; animation-delay: 1.2s; }
        .confetti-piece:nth-child(8) { left: 80%; background-color: #ff0; animation-duration: 2.7s; animation-delay: 0.7s; }
        .confetti-piece:nth-child(9) { left: 90%; background-color: #f0f; animation-duration: 2.1s; animation-delay: 0.3s; }
        .confetti-piece:nth-child(10) { left: 5%; background-color: #0ff; animation-duration: 2.9s; animation-delay: 1.8s; }
        .confetti-piece:nth-child(11) { left: 15%; background-color: #f80; animation-duration: 2.4s; animation-delay: 0.6s; }
        .confetti-piece:nth-child(12) { left: 25%; background-color: #80f; animation-duration: 3.1s; animation-delay: 1.1s; }
        .confetti-piece:nth-child(13) { left: 35%; background-color: #00f; animation-duration: 2.6s; animation-delay: 0.4s; }
        .confetti-piece:nth-child(14) { left: 45%; background-color: #ff0; animation-duration: 3.3s; animation-delay: 0.9s; }
        .confetti-piece:nth-child(15) { left: 55%; background-color: #f0f; animation-duration: 2.2s; animation-delay: 1.4s; }
        .confetti-piece:nth-child(16) { left: 65%; background-color: #0f0; animation-duration: 3s; animation-delay: 0s; }
        .confetti-piece:nth-child(17) { left: 75%; background-color: #f80; animation-duration: 2.5s; animation-delay: 0.5s; }
        .confetti-piece:nth-child(18) { left: 85%; background-color: #80f; animation-duration: 2.8s; animation-delay: 1s; }
        .confetti-piece:nth-child(19) { left: 95%; background-color: #00f; animation-duration: 2.3s; animation-delay: 0.2s; }
        .confetti-piece:nth-child(20) { left: 2%; background-color: #ff0; animation-duration: 3.2s; animation-delay: 0.8s; }


        .confetti-container.active .confetti-piece {
            opacity: 1;
        }

        /* Basic spinner for loading indication */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #6366f1; /* Indigo 500 */
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-left: 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="font-sans antialiased bg-gradient-to-br from-purple-400 via-pink-500 to-red-500 min-h-screen flex items-center justify-center p-4">

    <div class="relative bg-white bg-opacity-90 p-8 md:p-12 rounded-3xl shadow-2xl text-center max-w-lg w-full transform transition-all duration-500 scale-100 hover:scale-105">
        <div id="confetti-container" class="confetti-container absolute inset-0 overflow-hidden pointer-events-none">
            <div class="confetti-piece"></div>
            <div class="confetti-piece"></div>
            <div class="confetti-piece"></div>
            <div class="confetti-piece"></div>
            <div class="confetti-piece"></div>
            <div class="confetti-piece"></div>
            <div class="confetti-piece"></div>
            <div class="confetti-piece"></div>
            <div class="confetti-piece"></div>
            <div class="confetti-piece"></div>
            <div class="confetti-piece"></div>
            <div class="confetti-piece"></div>
            <div class="confetti-piece"></div>
            <div class="confetti-piece"></div>
            <div class="confetti-piece"></div>
            <div class="confetti-piece"></div>
            <div class="confetti-piece"></div>
            <div class="confetti-piece"></div>
            <div class="confetti-piece"></div>
            <div class="confetti-piece"></div>
        </div>

        <h1 class="text-4xl md:text-6xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-orange-600 mb-4 animate-bounce">
            Happy Birthday!
        </h1>
        <p class="text-xl md:text-3xl text-gray-800 mb-6">
            To my amazing brother, <span id="brother-name" class="font-bold text-purple-700"></span>!
        </p>

        <div class="mb-6">
            <input
                type="text"
                id="name-input"
                placeholder="Enter your brother's name"
                class="w-full p-3 rounded-xl border-2 border-purple-300 focus:outline-none focus:ring-2 focus:ring-purple-500 text-gray-700 placeholder-gray-400"
            />
        </div>

        <div class="mb-4">
            <textarea
                id="message-input"
                rows="3"
                placeholder="Write a special birthday message here..."
                class="w-full p-3 rounded-xl border-2 border-pink-300 focus:outline-none focus:ring-2 focus:ring-pink-500 text-gray-700 placeholder-gray-400 resize-none"
            ></textarea>
        </div>
        <button
            id="generate-message-button"
            class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded-full shadow-md transform transition-all duration-300 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-purple-300 mb-6"
        >
            Generate Message âœ¨
            <span id="message-spinner" class="spinner hidden"></span>
        </button>

        <button
            id="celebrate-button"
            class="bg-gradient-to-r from-green-400 to-blue-500 hover:from-green-500 hover:to-blue-600 text-white font-bold py-3 px-8 rounded-full shadow-lg transform transition-all duration-300 hover:scale-110 focus:outline-none focus:ring-4 focus:ring-blue-300"
        >
            Celebrate! ðŸŽ‰
        </button>

        <div id="display-message" class="mt-8 p-4 bg-purple-100 rounded-xl text-gray-700 italic hidden"></div>

        <div class="mt-8">
            <img src="https://placehold.co/400x300/E0BBE4/FFFFFF?text=Birthday+Cake" alt="Birthday Cake" class="rounded-xl shadow-md w-full max-h-96 object-cover"/>
        </div>

        <div class="mt-8 p-4 bg-yellow-100 rounded-xl">
            <h2 class="text-2xl font-bold text-yellow-700 mb-4">Gift Ideas</h2>
            <ul id="gift-ideas" class="list-disc list-inside text-gray-700 text-left">
                <li>A personalized gadget</li>
                <li>An experience day (e.g., go-karting, escape room)</li>
                <li>His favorite book or a series he'd enjoy</li>
                <li>A subscription box tailored to his hobbies</li>
                <li>High-quality headphones or gaming accessories</li>
            </ul>
            <button
                id="suggest-gifts-button"
                class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded-full shadow-md transform transition-all duration-300 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-yellow-300 mt-4"
            >
                Suggest Gifts âœ¨
                <span id="gift-spinner" class="spinner hidden"></span>
            </button>
            <div id="gift-suggestions-output" class="mt-4 text-gray-700 text-left"></div>
        </div>

        <div class="mt-8 p-4 bg-blue-100 rounded-xl">
             <h2 class="text-2xl font-bold text-blue-700 mb-4">Digital Birthday Card</h2>
             <img src="https://placehold.co/400x300/A0DAF9/FFFFFF?text=Digital+Birthday+Card" alt="Digital Birthday Card" class="rounded-xl shadow-md w-full max-h-96 object-cover"/>
             <p class="mt-4 text-gray-700">Wishing you a fantastic birthday filled with joy and laughter! May all your wishes come true.</p>
        </div>
    </div>

    <script>
        // Get references to DOM elements
        const nameInput = document.getElementById('name-input');
        const brotherNameSpan = document.getElementById('brother-name');
        const messageInput = document.getElementById('message-input');
        const celebrateButton = document.getElementById('celebrate-button');
        const confettiContainer = document.getElementById('confetti-container');
        const displayMessageDiv = document.getElementById('display-message');
        const generateMessageButton = document.getElementById('generate-message-button');
        const messageSpinner = document.getElementById('message-spinner');
        const suggestGiftsButton = document.getElementById('suggest-gifts-button');
        const giftSpinner = document.getElementById('gift-spinner');
        const giftSuggestionsOutput = document.getElementById('gift-suggestions-output');

        // Function to update brother's name dynamically
        nameInput.addEventListener('input', () => {
            brotherNameSpan.textContent = nameInput.value || 'Brother'; // Default to 'Brother' if input is empty
        });

        // Event listener for the celebrate button
        celebrateButton.addEventListener('click', () => {
            // Add 'active' class to confetti container to start animation
            confettiContainer.classList.add('active');

            // Display the personalized message
            const personalizedMessage = messageInput.value.trim();
            if (personalizedMessage) {
                displayMessageDiv.textContent = personalizedMessage;
                displayMessageDiv.classList.remove('hidden'); // Show the message div
            } else {
                displayMessageDiv.classList.add('hidden'); // Hide if no message
            }

            // Optional: Remove confetti after a few seconds
            setTimeout(() => {
                confettiContainer.classList.remove('active');
            }, 3000); // Confetti lasts for 3 seconds
        });

        // Function to call Gemini API for message generation
        generateMessageButton.addEventListener('click', async () => {
            const brotherName = nameInput.value.trim() || 'Brother';
            const prompt = `Write a heartfelt and slightly fun birthday message for my brother named ${brotherName}. Keep it concise, around 2-3 sentences.`;

            // Show spinner
            messageSpinner.classList.remove('hidden');
            generateMessageButton.disabled = true; // Disable button during loading

            let chatHistory = [];
            chatHistory.push({ role: "user", parts: [{ text: prompt }] });
            const payload = { contents: chatHistory };
            const apiKey = ""; // Leave as empty string for Canvas to provide
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const generatedText = result.candidates[0].content.parts[0].text;
                    messageInput.value = generatedText; // Populate the message input with generated text
                    displayMessageDiv.textContent = generatedText;
                    displayMessageDiv.classList.remove('hidden');
                } else {
                    console.error("Gemini API response structure unexpected:", result);
                    displayMessageDiv.textContent = "Could not generate message. Please try again.";
                    displayMessageDiv.classList.remove('hidden');
                }
            } catch (error) {
                console.error("Error generating message:", error);
                displayMessageDiv.textContent = "Error generating message. Please check your network connection.";
                displayMessageDiv.classList.remove('hidden');
            } finally {
                // Hide spinner and re-enable button
                messageSpinner.classList.add('hidden');
                generateMessageButton.disabled = false;
            }
        });

        // Function to call Gemini API for gift suggestions
        suggestGiftsButton.addEventListener('click', async () => {
            const brotherName = nameInput.value.trim() || 'Brother';
            const prompt = `Suggest 5 unique and thoughtful birthday gift ideas for a brother named ${brotherName}. Focus on general interests if no specific hobbies are known, or suggest diverse categories. Provide the suggestions as a JSON array of strings.`;

            // Show spinner
            giftSpinner.classList.remove('hidden');
            suggestGiftsButton.disabled = true; // Disable button during loading

            let chatHistory = [];
            chatHistory.push({ role: "user", parts: [{ text: prompt }] });
            const payload = {
                contents: chatHistory,
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "ARRAY",
                        items: { "type": "STRING" }
                    }
                }
            };
            // Corrected API URL: removed duplicate "googleapis"
            const apiKey = ""; // Leave as empty string for Canvas to provide
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const jsonString = result.candidates[0].content.parts[0].text;
                    const giftIdeas = JSON.parse(jsonString);

                    // Clear existing list and populate with new suggestions
                    giftSuggestionsOutput.innerHTML = ''; // Clear previous suggestions
                    const ul = document.createElement('ul');
                    ul.className = 'list-disc list-inside text-gray-700 text-left';
                    if (Array.isArray(giftIdeas) && giftIdeas.length > 0) {
                        giftIdeas.forEach(idea => {
                            const li = document.createElement('li');
                            li.textContent = idea;
                            ul.appendChild(li);
                        });
                    } else {
                        const li = document.createElement('li');
                        li.textContent = "No specific gift ideas generated. Try again!";
                        ul.appendChild(li);
                    }
                    giftSuggestionsOutput.appendChild(ul);

                } else {
                    console.error("Gemini API response structure unexpected:", result);
                    giftSuggestionsOutput.innerHTML = '<p class="text-red-500">Could not generate gift ideas. Please try again.</p>';
                }
            } catch (error) {
                console.error("Error generating gift ideas:", error);
                giftSuggestionsOutput.innerHTML = '<p class="text-red-500">Error generating gift ideas. Please check your network connection.</p>';
            } finally {
                // Hide spinner and re-enable button
                giftSpinner.classList.add('hidden');
                suggestGiftsButton.disabled = false;
            }
        });

        // Set initial name on load
        document.addEventListener('DOMContentLoaded', () => {
            brotherNameSpan.textContent = 'Brother';
        });
    </script>
</body>
</html>
